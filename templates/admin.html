{% extends "base.html" %}
{% block content %}
<h1>Admin Interface</h1>

<form method="get" action="{{ url_for('admin') }}">
  <label for="table">Select a table:</label>
  <select name="table" id="table" onchange="this.form.submit()">
    <option value="">-- Choose a table --</option>
    {% for table in tables %}
      <option value="{{ table }}" {% if table == selected_table %}selected{% endif %}>{{ table }}</option>
    {% endfor %}
  </select>
</form>

{% if selected_table %}
  <form method="get" action="{{ url_for('admin') }}" class="search-section">
    <input type="hidden" name="table" value="{{ selected_table }}">
    <label for="search">Search:</label>
    <input type="text" id="search" name="search" value="{{ search_query or '' }}">
    <button type="submit">Search</button>
  </form>

  <p>
    <a href="{{ url_for('add_record', table=selected_table) }}">âž• Add New Record</a>
  </p>

  <h2>Results for "{{ selected_table }}"</h2>

  {% if results %}
    <table border="1" cellpadding="5" cellspacing="0">
      <thead>
        <tr>
          {% for column in column_names %}
            <th>{{ column }}</th>
          {% endfor %}
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for row in results %}
          <tr>
            {% for column in column_names %}
              <td>{{ row[column] }}</td>
            {% endfor %}
            <td>
              <a href="{{ url_for('edit_record', table=selected_table, record_id=row['id']) }}">Edit</a> |
              <a href="{{ url_for('delete_record', table=selected_table, record_id=row['id']) }}"
                 onclick="return confirm('Are you sure you want to delete this entry?');">Delete</a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>No results found.</p>
  {% endif %}
{% endif %}
{% endblock %}

